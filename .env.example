# ============================================
# Telegram Bot Configuration
# ============================================
# Required for Telegram bot functionality
API_ID=
API_HASH=
BOT_TOKEN=
OWNER_ID=

# ============================================
# Rclone Configuration
# ============================================
# Required for cloud storage operations
RCLONE_REMOTE=
REMOTE_FOLDER=
RCLONE_CONF_BASE64=

# ============================================
# QStash Configuration
# ============================================
# Required for message queue and webhook processing
# QSTASH_AUTH_TOKEN: Used for publishing messages (starts with 'authorization_')
# QSTASH_CURRENT_SIGNING_KEY: Used for verifying webhooks (starts with 'sig_')
QSTASH_AUTH_TOKEN=
QSTASH_TOKEN=
QSTASH_CURRENT_SIGNING_KEY=
QSTASH_NEXT_SIGNING_KEY=
QSTASH_URL=
LB_WEBHOOK_URL=

# ============================================
# OSS Worker Configuration
# ============================================
# Optional: For object storage operations
OSS_WORKER_URL=
OSS_WORKER_SECRET=

# ============================================
# Cloudflare R2 Configuration
# ============================================
# Optional: For R2 storage backend
R2_ENDPOINT=
R2_ACCESS_KEY_ID=
R2_SECRET_ACCESS_KEY=
R2_BUCKET=
R2_PUBLIC_URL=

# ============================================
# Axiom Configuration
# ============================================
# Optional: For logging and observability
AXIOM_TOKEN=
AXIOM_ORG_ID=
AXIOM_DATASET=

# ============================================
# Redis Configuration
# ============================================
# Primary Redis connection URL (TLS/SNI enabled)
# Format: rediss://username:password@host:port
# Example: rediss://user:password@master.drive-collector-redis--qmnl9h54d875.addon.code.run:6379
REDIS_URL=

# Alternative: Individual connection parameters
REDIS_HOST=
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_TOKEN=

# Northflank Redis Configuration (NF_ Prefix) - Legacy support
NF_REDIS_URL=
NF_REDIS_HOST=
NF_REDIS_PORT=6379
NF_REDIS_PASSWORD=

# ============================================
# Cloudflare Cache Configuration
# ============================================
# Required for distributed key-value storage
# Used for: caching, rate limiting, instance coordination
# Supports both CF_CACHE_* (new) and CF_KV_* (legacy) variables
CF_CACHE_ACCOUNT_ID=
CF_CACHE_NAMESPACE_ID=
CF_CACHE_TOKEN=

# Legacy Cloudflare KV variables (deprecated, use CF_CACHE_* above)
CF_KV_ACCOUNT_ID=
CF_KV_NAMESPACE_ID=
CF_KV_TOKEN=

# ============================================
# Upstash Redis Configuration
# ============================================
# Required for Redis operations via REST API
# Used for: caching, session management, task queue
UPSTASH_REDIS_REST_URL=
UPSTASH_REDIS_REST_TOKEN=

# ============================================
# Telegram Proxy Configuration
# ============================================
# Optional: For Telegram connection through proxy
TELEGRAM_PROXY_HOST=
TELEGRAM_PROXY_PORT=
TELEGRAM_PROXY_TYPE=
TELEGRAM_PROXY_USERNAME=
TELEGRAM_PROXY_PASSWORD=

# ============================================
# Telegram Advanced Configuration
# ============================================
TG_DEVICE_MODEL=
TG_SYSTEM_VERSION=
TG_APP_VERSION=
TG_TEST_MODE=false # 设置为 true 以连接 Telegram 测试服务器。如果未设置，在 dev 模式 (npm run dev) 下默认为 true。

# ============================================
# Redis TLS Configuration
# ============================================
# Optional: For custom TLS settings
REDIS_TLS_ENABLED=false
NF_REDIS_TLS_ENABLED=false
REDIS_TLS_REJECT_UNAUTHORIZED=true
NF_REDIS_TLS_REJECT_UNAUTHORIZED=true
REDIS_TLS_CA=
NF_REDIS_TLS_CA=
REDIS_TLS_CLIENT_CERT=
NF_REDIS_TLS_CLIENT_CERT=
REDIS_TLS_CLIENT_KEY=
NF_REDIS_TLS_CLIENT_KEY=
REDIS_SNI_SERVERNAME=
NF_REDIS_SNI_SERVERNAME=

# ============================================
# Redis Connection Optimization
# ============================================
# Optional: Connection pool and retry settings
REDIS_CONNECT_TIMEOUT=15000
REDIS_KEEP_ALIVE=30000
REDIS_LAZY_CONNECT=true
REDIS_ENABLE_READY_CHECK=true
REDIS_MAX_RETRIES_PER_REQUEST=5
REDIS_ENABLE_AUTO_PIPELINING=true
REDIS_MAX_RETRIES=5
REDIS_RETRY_BASE_DELAY=500
REDIS_RETRY_MAX_DELAY=30000

# ============================================
# Infisical Configuration
# ============================================
# Optional: For automatic environment variable synchronization
# Used by: scripts/sync-env.js
#
# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ IMPORTANT: 引号处理说明 (Quote Handling)                                    │
# ├─────────────────────────────────────────────────────────────────────────────┤
# │ Infisical CLI 和 API 可能返回带引号的值，例如:                               │
# │   - "redis://example.com:6379"                                              │
# │   - 'token_value'                                                           │
# │   - "value with spaces"                                                     │
# │                                                                             │
# │ 脚本会自动去除外层引号，确保最终值为:                                       │
# │   - redis://example.com:6379                                                │
# │   - token_value                                                             │
# │   - value with spaces                                                       │
# │                                                                             │
# │ 示例:                                                                       │
# │   INFISICAL_TOKEN='abc123'     → 脚本处理后: abc123                         │
# │   REDIS_URL="rediss://..."    → 脚本处理后: rediss://...                    │
# │   API_HASH="api_hash_value"   → 脚本处理后: api_hash_value                  │
# └─────────────────────────────────────────────────────────────────────────────┘
#
# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ 4级降级链策略 (4-Level Fallback Chain)                                     │
# ├─────────────────────────────────────────────────────────────────────────────┤
# │ 降级策略根据 STRICT_SYNC 环境变量分为两种模式:                              │
# │                                                                             │
# │ 【严格同步模式】STRICT_SYNC=1 (默认)                                        │
# │   1. CLI 模式 (Infisical CLI)                                               │
# │      - 需要: 安装 infisical 命令行工具                                      │
# │      - 命令: infisical secrets get --env=<env>                              │
# │      - 失败: 进入下一级                                                     │
# │   2. API 模式 (Infisical REST API)                                          │
# │      - 需要: INFISICAL_TOKEN, INFISICAL_PROJECT_ID                           │
# │      - 重试: 3次，间隔递增                                                  │
# │      - 失败: **直接退出** (严格模式)                                        │
# │                                                                             │
# │ 【宽松模式】STRICT_SYNC=0                                                    │
# │   1. CLI 模式 (Infisical CLI)                                               │
# │      - 同上                                                                 │
# │   2. API 模式 (Infisical REST API)                                          │
# │      - 同上                                                                 │
# │   3. 本地 .env 文件缓存                                                     │
# │      - 读取: .env.cache 文件 (由脚本自动创建)                               │
# │      - 用途: 网络中断时的备用方案                                           │
# │   4. 云服务商 Dashboard 配置                                                │
# │      - 来源: 当前进程的 process.env                                         │
# │      - 用途: 从云平台环境变量直接读取                                       │
# │      - 失败: 输出警告并继续运行 (使用现有配置)                              │
# └─────────────────────────────────────────────────────────────────────────────┘
#
# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ 配置建议 (Configuration Recommendations)                                   │
# ├─────────────────────────────────────────────────────────────────────────────┤
# │ 场景 1: 生产环境部署 (Production)                                           │
# │   - STRICT_SYNC=1                                                           │
# │   - 配置: CLI + API 双重验证                                                │
# │   - 目的: 确保配置完整性和安全性                                            │
# │                                                                             │
# │ 场景 2: 开发环境 (Development)                                              │
# │   - STRICT_SYNC=0                                                           │
# │   - 配置: API + 本地缓存                                                    │
# │   - 目的: 提高开发效率，允许降级                                             │
# │                                                                             │
# │ 场景 3: 网络不稳定环境                                                      │
# │   - STRICT_SYNC=0                                                           │
# │   - 配置: API + 本地缓存 + 云服务商配置                                     │
# │   - 目的: 最大化可用性                                                      │
# │                                                                             │
# │ 场景 4: 无 Infisical 依赖                                                   │
# │   - 不配置 INFISICAL_* 变量                                                 │
# │   - 脚本自动跳过 Infisical，直接使用云服务商配置                            │
# │   - 目的: 完全依赖云平台环境变量                                            │
# └─────────────────────────────────────────────────────────────────────────────┘
#
# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ 云服务商配置说明 (Cloud Provider Integration)                              │
# ├─────────────────────────────────────────────────────────────────────────────┤
# │ 云平台环境变量优先级:                                                        │
# │   1. Infisical (最高优先级)                                                 │
# │   2. 本地 .env.cache 缓存                                                   │
# │   3. 云平台环境变量 (process.env)                                           │
# │                                                                             │
# │ 支持的云平台:                                                                │
# │   • Cloudflare Workers: 通过 wrangler.toml 或 Dashboard 设置               │
# │   • Vercel: 通过 Project Settings → Environment Variables                   │
# │   • AWS: 通过 Systems Manager Parameter Store 或 Secrets Manager            │
# │   • Google Cloud: 通过 Secret Manager 或 Environment Variables              │
# │   • Azure: 通过 App Configuration 或 Key Vault                              │
# │   • Northflank: 通过 Add-on 环境变量配置                                   │
# │                                                                             │
# │ 配置同步流程:                                                                │
# │   1. 脚本从 Infisical 获取最新配置                                          │
# │   2. 自动去除引号并验证格式                                                 │
# │   3. 与云平台现有配置对比                                                   │
# │   4. 更新差异 (如果需要)                                                    │
# │   5. 生成 .env.cache 作为备份                                               │
# │                                                                             │
# │ 最佳实践:                                                                    │
# │   • 生产环境: 始终使用 STRICT_SYNC=1                                        │
# │   • 敏感信息: 优先使用 Infisical 或云平台 Secrets Manager                   │
# │   • 本地开发: 可使用 .env.local 覆盖云平台配置                              │
# │   • 版本控制: 永远不要提交包含真实值的 .env 文件                            │
# └─────────────────────────────────────────────────────────────────────────────┘
#
# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ CI/CD 引号处理 (CI/CD Quote Handling)                                      │
# ├─────────────────────────────────────────────────────────────────────────────┤
# │ 问题: Infisical 可能返回带引号的值                                          │
# │   • KEY="value" → 需要清理为 KEY=value                                     │
# │   • KEY='value' → 需要清理为 KEY=value                                     │
# │   • KEY="it's" → 需要清理为 KEY=it's                                       │
# │                                                                             │
# │ 解决方案: CI 中自动执行引号清理                                             │
# │   - 本地脚本: 已内置 stripQuotes() 函数                                    │
# │   - CI 流程: sync:env 后执行 sed 命令清理                                  │
# │                                                                             │
# │ CI 示例 (.github/workflows/ci.yml):                                         │
# │   - name: Sync from Infisical                                              │
# │     run: npm run sync:env                                                  │
# │                                                                             │
# │   - name: Clean up quotes                                                  │
# │     if: success() || failure()                                             │
# │     run: |                                                                 │
# │       if [ -f .env ]; then                                                 │
# │         sed -i 's/="\([^"]*\)"/=\1/g' .env                                │
# │         sed -i "s/='\([^']*\)'/=\1/g" .env                                │
# │         sed -i 's/^"\(.*\)"$/\1/' .env                                    │
# │         sed -i "s/^'\(.*\)'$/\1/" .env                                    │
# │       fi                                                                   │
# │                                                                             │
# │ 处理结果:                                                                    │
# │   • API_KEY="abc123" → API_KEY=abc123                                      │
# │   • BOT_TOKEN='xyz789' → BOT_TOKEN=xyz789                                  │
# │   • MESSAGE="Hello \"World\"" → MESSAGE=Hello "World"                      │
# │   • URL=https://example.com → URL=https://example.com (不变)                │
# └─────────────────────────────────────────────────────────────────────────────┘
#
# 使用说明:
# 1. 本地开发: 设置 INFISICAL_TOKEN 和 INFISICAL_PROJECT_ID 后运行 npm run dev
# 2. CI/CD:
#    - INFISICAL_TOKEN: 配置在 GitHub Secrets (敏感信息)
#    - INFISICAL_PROJECT_ID: 配置在 GitHub Variables (非敏感配置)
#    - 对齐 lb-worker-js 配置方式
# 3. Docker: 运行时传递 INFISICAL_TOKEN 和 INFISICAL_PROJECT_ID 环境变量
# 4. 降级: 设置 STRICT_SYNC=0 允许降级到本地缓存或云配置
#
# 环境变量优先级: INFISICAL_ENV > NODE_ENV > 'dev' (默认)
# 环境名称支持简写: dev/pre/prod (兼容全写: development/production/staging)
INFISICAL_TOKEN=
INFISICAL_PROJECT_ID=
NODE_ENV=prod
INFISICAL_ENV=prod
INFISICAL_SECRET_PATH=/
STRICT_SYNC=1

# ============================================
# Worker Configuration
# ============================================
# Optional: Server port for webhooks
PORT=