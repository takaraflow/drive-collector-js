{
  "manifest_version": "1.1",
  "id": "drive-collector-js",
  "name": "Drive Collector Bot",
  "version": "4.30.0",
  "description": "基于 JSON Schema 契约中心的分布式转存项目，支持 Telegram 媒体转存至 Rclone/S3。",
  "type": "worker",
  "capabilities": [
    "telegram-bot",
    "distributed-task-scheduling",
    "multi-instance-locking",
    "instance-registration",
    "qstash-webhook",
    "d1-storage",
    "cache-failover",
    "rclone-integration",
    "s3-transfer",
    "sec-transfer",
    "diagnosis-reporting",
    "newrelic-logging"
  ],
  "behaviors": {
    "telegramHandler": {
      "description": "处理 Telegram 消息与回调，包含去重、权限校验与媒体聚合",
      "input": "telegram-mtproto",
      "inputSchema": {
        "type": "object",
        "properties": {
          "update": {
            "type": "object",
            "description": "Telegram Update 对象",
            "properties": {
              "update_id": {
                "type": "number"
              },
              "message": {
                "type": "object"
              },
              "callback_query": {
                "type": "object"
              }
            }
          }
        },
        "required": [
          "update"
        ]
      },
      "locking": {
        "mechanism": "cache",
        "pattern": "msg_lock:{msgId}",
        "ttl": 60,
        "description": "基于消息 ID 的去重锁，防止重复处理"
      },
      "dependencies": [
        "AuthGuard",
        "SessionManager",
        "InstanceCoordinator"
      ],
      "reliability": {
        "timeout": 30,
        "errorHandling": "graceful-degradation",
        "fallback": "skip-duplicate"
      }
    },
    "taskProcessor": {
      "description": "基于 QStash Webhook 的分布式任务处理器",
      "input": "qstash-webhook",
      "inputSchema": {
        "type": "object",
        "properties": {
          "taskId": {
            "type": "string"
          },
          "groupId": {
            "type": "string"
          },
          "taskIds": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "type": {
            "type": "string",
            "enum": [
              "download",
              "upload",
              "batch",
              "system-event"
            ]
          },
          "event": {
            "type": "string"
          },
          "payload": {
            "type": "object"
          },
          "timestamp": {
            "type": "number"
          }
        },
        "required": [
          "type"
        ]
      },
      "endpoints": {
        "health": "/health",
        "healthz": "/healthz",
        "ready": "/ready",
        "webhookBase": "/api/v2/tasks",
        "download": "/api/v2/tasks/download",
        "upload": "/api/v2/tasks/upload",
        "batch": "/api/v2/tasks/batch",
        "systemEvents": "/api/v2/tasks/system-events",
        "streamForward": "/api/v2/stream/:taskId",
        "statusUpdate": "/api/v2/tasks/:taskId/status",
        "legacyWebhookBase": "/api/tasks",
        "legacyDownload": "/api/tasks/download",
        "legacyUpload": "/api/tasks/upload",
        "legacyBatch": "/api/tasks/batch",
        "legacySystemEvents": "/api/tasks/system-events"
      },
      "locking": {
        "mechanism": "cache",
        "pattern": "task:{taskId}",
        "ttl": 600,
        "description": "任务级分布式锁，支持故障转移后的延迟恢复"
      },
      "dependencies": [
        "TaskManager",
        "QStashService",
        "D1",
        "Cache",
        "InstanceCoordinator"
      ],
      "reliability": {
        "retry": "qstash-default",
        "failover": "delayed-recovery-on-cache-error",
        "maxRetries": 3,
        "timeout": 300
      }
    },
    "storageUploader": {
      "description": "三轨制存储上传器 (Worker -> S3 -> Rclone)",
      "input": "local-file",
      "inputSchema": {
        "type": "object",
        "properties": {
          "filePath": {
            "type": "string"
          },
          "fileId": {
            "type": "string"
          },
          "size": {
            "type": "number"
          },
          "hash": {
            "type": "string"
          }
        },
        "required": [
          "filePath",
          "fileId"
        ]
      },
      "outputs": [
        "rclone",
        "s3"
      ],
      "features": [
        "sec-transfer",
        "dynamic-cache-ttl",
        "integrity-verification"
      ],
      "locking": {
        "mechanism": "local-mutex",
        "description": "本地文件上传互斥锁，防止并发上传同一文件"
      },
      "dependencies": [
        "CloudTool (rclone)",
        "OSSService",
        "ossHelper"
      ],
      "reliability": {
        "secTransfer": {
          "enabled": true,
          "description": "秒传校验，基于文件哈希快速验证存在性"
        },
        "cacheStrategy": {
          "ttl": "dynamic",
          "basis": "file-access-frequency"
        },
        "integrityCheck": "sha256"
      }
    },
    "instanceCoordinator": {
      "description": "多实例协调器，负责注册、心跳、领导者选举与分布式锁 management，并上报 activeTaskCount 用于全局活跃任务统计",
      "input": "internal-timer",
      "inputSchema": {
        "type": "object",
        "properties": {
          "action": {
            "type": "string",
            "enum": [
              "register",
              "heartbeat",
              "leader-check",
              "cleanup"
            ]
          }
        }
      },
      "locking": {
        "mechanism": "cache-atomic",
        "patterns": [
          "instance:{instanceId}",
          "lock:{lockKey}",
          "task:{taskId}"
        ],
        "ttl": 900,
        "description": "基于 Cache 的原子操作实现分布式锁，支持锁续约与自动过期"
      },
      "dependencies": [
        "CacheService"
      ],
      "reliability": {
        "heartbeatInterval": 30,
        "timeout": 90,
        "cleanupInterval": 300,
        "leaderElection": {
          "strategy": "minimum-id",
          "description": "所有活跃实例按 ID 字典序排序，排名第一的实例自动成为 Leader"
        },
        "dynamicAdjustment": {
          "enabled": true,
          "description": "根据实例规模自动调整心跳频率：<50实例为30s，>200实例自动降频至60s以保护 KV 写入配额"
        }
      }
    },
    "driveRepository": {
      "description": "网盘配置存储库，支持活跃网盘列表管理",
      "input": "cache-storage",
      "features": [
        "active-drives-list",
        "drive-id-lookup"
      ],
      "reliability": {
        "cacheStrategy": "cache-with-json",
        "errorHandling": "graceful-degradation",
        "fallback": "empty-array"
      },
      "dependencies": [
        "CacheService"
      ]
    }
  },
  "instanceRegistration": {
    "mechanism": "Distributed Cache (Redis/KV/Upstash)",
    "heartbeatInterval": 30,
    "timeout": 90,
    "keys": [
      {
        "pattern": "instance:{instanceId}",
        "description": "实例元数据（包含 activeTaskCount）"
      },
      {
        "pattern": "lock:{lockKey}",
        "description": "分布式锁"
      },
      {
        "pattern": "task:{taskId}",
        "description": "任务锁"
      },
      {
        "pattern": "msg_lock:{msgId}",
        "description": "消息去重锁"
      }
    ],
    "locking": {
      "mechanism": "cache-atomic",
      "operations": {
        "acquire": "get-skip-cache-then-set-with-ttl",
        "release": "delete",
        "renew": "update-ttl"
      },
      "conflictResolution": "last-write-wins-with-verify-read",
      "description": "基于 Cache 的原子操作实现分布式锁，支持锁续约、自动过期与写后校验"
    },
    "valueSchema": {
      "instance": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "url": {
            "type": "string"
          },
          "hostname": {
            "type": "string"
          },
          "region": {
            "type": "string"
          },
          "startedAt": {
            "type": "number"
          },
          "lastHeartbeat": {
            "type": "number"
          },
          "status": {
            "type": "string",
            "enum": [
              "active",
              "offline"
            ]
          },
          "activeTaskCount": {
            "type": "number",
            "description": "该实例当前活跃任务数量（由实例自上报，用于全局聚合统计）"
          }
        },
        "required": [
          "id",
          "hostname",
          "startedAt",
          "lastHeartbeat",
          "status"
        ]
      },
      "lock": {
        "type": "object",
        "properties": {
          "instanceId": {
            "type": "string"
          },
          "acquiredAt": {
            "type": "number"
          },
          "ttl": {
            "type": "number"
          }
        },
        "required": [
          "instanceId",
          "acquiredAt",
          "ttl"
        ]
      }
    },
    "leaderElection": {
      "strategy": "minimum-id",
      "description": "所有活跃实例按 ID 字典序排序，排名第一的实例自动成为 Leader",
      "leaderResponsibilities": [
        "cleanup-expired-instances",
        "monitor-distributed-locks",
        "coordinator-health-check"
      ]
    },
    "reliability": {
      "cleanupInterval": 300,
      "maxLockHoldTime": 1800,
      "lockRenewalThreshold": 0.7,
      "failoverStrategy": "immediate-reacquire-on-timeout"
    }
  },
  "entrypoint": "index.js",
  "runtime": {
    "type": "nodejs",
    "version": "nodejs20"
  },
  "config": {
    "env": {
      "API_ID": {
        "type": "number",
        "required": true,
        "description": "Telegram API ID"
      },
      "API_HASH": {
        "type": "string",
        "required": true,
        "description": "Telegram API Hash",
        "sensitive": true,
        "configPaths": [
          "apiHash"
        ]
      },
      "BOT_TOKEN": {
        "type": "string",
        "required": true,
        "description": "Telegram Bot Token",
        "sensitive": true,
        "configPaths": [
          "botToken"
        ]
      },
      "OWNER_ID": {
        "type": "string",
        "required": true,
        "description": "Admin User ID"
      },
      "NODE_ENV": {
        "type": "string",
        "required": false,
        "description": "Node.js runtime environment (dev/pre/prod/test). Supports both full names (development/production/staging) and abbreviations. Defaults to dev."
      },
      "NODE_MODE": {
        "type": "string",
        "required": false,
        "description": "Application mode (bot/dev/etc.)"
      },
      "APP_VERSION": {
        "type": "string",
        "required": false,
        "description": "Application version override for logging"
      },
      "INSTANCE_ID": {
        "type": "string",
        "required": false,
        "description": "Instance ID override for multi-instance coordination"
      },
      "INSTANCE_COUNT": {
        "type": "number",
        "required": false,
        "description": "Active instance count reported from Infisical so each worker knows the current fleet size"
      },
      "APP_EXTERNAL_URL": {
        "type": "string",
        "required": false,
        "description": "External URL for load balancer routing"
      },
      "DOWNLOAD_DIR": {
        "type": "string",
        "required": false,
        "description": "Local download directory (defaults to OS temp downloads)"
      },
      "QSTASH_DEBUG": {
        "type": "string",
        "required": false,
        "description": "Set to true/1/yes to enable verbose QStash publish debug logs"
      },
      "QSTASH_FORCE_DIRECT": {
        "type": "string",
        "required": false,
        "description": "Set to true/1/yes to bypass buffering and send QStash publishes immediately (diagnostics only)"
      },
      "DOTENV_OVERRIDE": {
        "type": "string",
        "required": false,
        "description": "Controls whether dotenv files override existing env vars. Default: dev overrides, prod/pre do not. Set true to force override in prod/pre."
      },
      "CALLER_TRACKING_MODE": {
        "type": "string",
        "required": false,
        "description": "Set to production to attach caller stack context to queue messages (diagnostics)"
      },
      "CACHE_L3_ENABLED": {
        "type": "string",
        "required": false,
        "description": "Set to true to enable persistent L3 cache layer"
      },
      "CACHE_BLOOM_FILTER": {
        "type": "string",
        "required": false,
        "description": "Set to true to enable bloom filter protection for cache penetration"
      },
      "BATCH_SIZE": {
        "type": "number",
        "required": false,
        "description": "Default batch size for cloud queue buffering (fallback for providers)"
      },
      "BATCH_TIMEOUT": {
        "type": "number",
        "required": false,
        "description": "Default batch flush timeout in ms for cloud queue buffering (fallback for providers)"
      },
      "QSTASH_BATCH_SIZE": {
        "type": "number",
        "required": false,
        "description": "QStash queue batch size (overrides BATCH_SIZE)"
      },
      "QSTASH_BATCH_TIMEOUT": {
        "type": "number",
        "required": false,
        "description": "QStash queue batch timeout in ms (overrides BATCH_TIMEOUT)"
      },
      "QSTASH_MAX_BUFFER_SIZE": {
        "type": "number",
        "required": false,
        "description": "Max in-memory buffer size before dropping oldest messages"
      },
      "QSTASH_PROCESSED_MESSAGES_LIMIT": {
        "type": "number",
        "required": false,
        "description": "Max size for in-memory idempotency cache"
      },
      "QSTASH_DLQ_SIZE": {
        "type": "number",
        "required": false,
        "description": "Max dead-letter queue size"
      },
      "QSTASH_MAX_CONCURRENT": {
        "type": "number",
        "required": false,
        "description": "Max concurrent QStash publish operations in batch mode"
      },
      "QSTASH_MOCK_DELAY": {
        "type": "number",
        "required": false,
        "description": "Mock mode: artificial delay in ms"
      },
      "QSTASH_MOCK_ERROR": {
        "type": "string",
        "required": false,
        "description": "Mock mode: inject error type for testing"
      },
      "QSTASH_RATE_LIMIT": {
        "type": "number",
        "required": false,
        "description": "Upstash QStash rate limit (requests per window)"
      },
      "QSTASH_RATE_WINDOW": {
        "type": "number",
        "required": false,
        "description": "Upstash QStash rate limit window in ms"
      },
      "QSTASH_ADAPTIVE_RATE": {
        "type": "string",
        "required": false,
        "description": "Set to true to enable adaptive rate limit adjustment"
      },
      "QSTASH_MIN_RATE": {
        "type": "number",
        "required": false,
        "description": "Adaptive rate limiter minimum requests per window"
      },
      "QSTASH_MAX_RATE": {
        "type": "number",
        "required": false,
        "description": "Adaptive rate limiter maximum requests per window"
      },
      "HOSTNAME": {
        "type": "string",
        "required": false,
        "description": "Hostname identifier for instance metadata"
      },
      "INSTANCE_REGION": {
        "type": "string",
        "required": false,
        "description": "Instance region identifier for instance metadata"
      },
      "QSTASH_TOKEN": {
        "type": "string",
        "required": true,
        "description": "Upstash QStash Token",
        "sensitive": true,
        "configPaths": [
          "token"
        ]
      },
      "QSTASH_AUTH_TOKEN": {
        "type": "string",
        "required": false,
        "description": "Upstash QStash auth token (legacy publishing token)",
        "sensitive": true,
        "configPaths": [
          "token"
        ]
      },
      "QSTASH_URL": {
        "type": "string",
        "required": true,
        "description": "QStash API 地址"
      },
      "QSTASH_CURRENT_SIGNING_KEY": {
        "type": "string",
        "required": false,
        "description": "QStash Webhook current signing key",
        "sensitive": true,
        "configPaths": [
          "currentSigningKey"
        ]
      },
      "QSTASH_NEXT_SIGNING_KEY": {
        "type": "string",
        "required": false,
        "description": "QStash Webhook next signing key",
        "sensitive": true,
        "configPaths": [
          "nextSigningKey"
        ]
      },
      "LB_WEBHOOK_URL": {
        "type": "string",
        "required": true,
        "description": "Webhook callback URL for QStash"
      },
      "DATADOG_SITE": {
        "type": "string",
        "required": false,
        "description": "Datadog site (e.g. datadoghq.com, datadoghq.eu)"
      },
      "HTTP2_ENABLED": {
        "type": "string",
        "required": false,
        "description": "Enable HTTP/2 server (true/false)"
      },
      "HTTP2_PLAIN": {
        "type": "string",
        "required": false,
        "description": "Use plaintext HTTP/2 (h2c) instead of TLS (true/false)"
      },
      "HTTP2_ALLOW_HTTP1": {
        "type": "string",
        "required": false,
        "description": "Allow HTTP/1.1 fallback when HTTP/2 is enabled (true/false)"
      },
      "HTTP2_TLS_KEY_PATH": {
        "type": "string",
        "required": false,
        "description": "TLS key path for HTTP/2 server"
      },
      "HTTP2_TLS_CERT_PATH": {
        "type": "string",
        "required": false,
        "description": "TLS cert path for HTTP/2 server"
      },
      "TLS_KEY_PATH": {
        "type": "string",
        "required": false,
        "description": "TLS key path (legacy)"
      },
      "TLS_CERT_PATH": {
        "type": "string",
        "required": false,
        "description": "TLS cert path (legacy)"
      },
      "RCLONE_REMOTE": {
        "type": "string",
        "default": "mega",
        "description": "Rclone 远程名称"
      },
      "REMOTE_FOLDER": {
        "type": "string",
        "default": "/DriveCollectorBot",
        "description": "远程存储目录"
      },
      "RCLONE_CONF_BASE64": {
        "type": "string",
        "required": false,
        "description": "Rclone 配置文件的 Base64 编码"
      },
      "OSS_WORKER_URL": {
        "type": "string",
        "required": false,
        "description": "OSS Worker URL for object storage operations"
      },
      "OSS_WORKER_SECRET": {
        "type": "string",
        "required": false,
        "description": "OSS Worker secret for authentication",
        "sensitive": true,
        "configPaths": [
          "workerSecret"
        ]
      },
      "R2_ENDPOINT": {
        "type": "string",
        "required": false,
        "description": "Cloudflare R2 endpoint"
      },
      "R2_ACCESS_KEY_ID": {
        "type": "string",
        "required": false,
        "description": "Cloudflare R2 access key ID",
        "sensitive": true,
        "configPaths": [
          "accessKeyId"
        ]
      },
      "R2_SECRET_ACCESS_KEY": {
        "type": "string",
        "required": false,
        "description": "Cloudflare R2 secret access key",
        "sensitive": true,
        "configPaths": [
          "secretAccessKey"
        ]
      },
      "R2_BUCKET": {
        "type": "string",
        "required": false,
        "description": "Cloudflare R2 bucket name"
      },
      "R2_PUBLIC_URL": {
        "type": "string",
        "required": false,
        "description": "Cloudflare R2 public URL"
      },
      "AXIOM_TOKEN": {
        "type": "string",
        "required": false,
        "description": "Axiom 日志令牌"
      },
      "AXIOM_ORG_ID": {
        "type": "string",
        "required": false,
        "description": "Axiom organization ID"
      },
      "AXIOM_DATASET": {
        "type": "string",
        "required": false,
        "description": "Axiom dataset name"
      },
      "DATADOG_API_KEY": {
        "type": "string",
        "required": false,
        "description": "Datadog API key for log shipping",
        "sensitive": true
      },
      "CLOUDFLARE_D1_ACCOUNT_ID": {
        "type": "string",
        "required": false,
        "description": "Cloudflare D1 account ID"
      },
      "CLOUDFLARE_D1_DATABASE_ID": {
        "type": "string",
        "required": false,
        "description": "Cloudflare D1 database ID"
      },
      "CLOUDFLARE_D1_TOKEN": {
        "type": "string",
        "required": false,
        "description": "Cloudflare D1 API token"
      },
      "CLOUDFLARE_ACCOUNT_ID": {
        "type": "string",
        "required": false,
        "description": "Cloudflare account ID (fallback for KV/D1)"
      },
      "CLOUDFLARE_KV_ACCOUNT_ID": {
        "type": "string",
        "required": false,
        "description": "Cloudflare account ID for KV storage"
      },
      "CLOUDFLARE_KV_NAMESPACE_ID": {
        "type": "string",
        "required": false,
        "description": "Cloudflare KV namespace ID"
      },
      "CLOUDFLARE_KV_TOKEN": {
        "type": "string",
        "required": false,
        "description": "Cloudflare KV API token"
      },
      "PORT": {
        "type": "number",
        "default": 8080,
        "description": "Server port for webhooks"
      },
      "TELEGRAM_PROXY_HOST": {
        "type": "string",
        "required": false,
        "description": "Telegram 代理服务器地址"
      },
      "TELEGRAM_PROXY_PORT": {
        "type": "number",
        "required": false,
        "description": "Telegram 代理服务器端口"
      },
      "TELEGRAM_PROXY_TYPE": {
        "type": "string",
        "required": false,
        "enum": [
          "socks4",
          "socks5"
        ],
        "default": "socks5",
        "description": "Telegram 代理类型，支持 socks4 和 socks5"
      },
      "TELEGRAM_PROXY_USERNAME": {
        "type": "string",
        "required": false,
        "description": "Telegram 代理服务器用户名"
      },
      "TELEGRAM_PROXY_PASSWORD": {
        "type": "string",
        "required": false,
        "description": "Telegram 代理服务器密码"
      },
      "TG_DEVICE_MODEL": {
        "type": "string",
        "required": false,
        "description": "Telegram client device model"
      },
      "TG_SYSTEM_VERSION": {
        "type": "string",
        "required": false,
        "description": "Telegram client system version"
      },
      "TG_APP_VERSION": {
        "type": "string",
        "required": false,
        "description": "Telegram client app version"
      },
      "TG_TEST_MODE": {
        "type": "boolean",
        "required": false,
        "description": "Enable Telegram test mode"
      },
      "TG_SERVER_DC": {
        "type": "number",
        "required": false,
        "description": "Telegram DC override (requires TG_SERVER_IP and TG_SERVER_PORT)"
      },
      "TG_SERVER_IP": {
        "type": "string",
        "required": false,
        "description": "Telegram server IP override (requires TG_SERVER_DC and TG_SERVER_PORT)"
      },
      "TG_SERVER_PORT": {
        "type": "number",
        "required": false,
        "description": "Telegram server port override (requires TG_SERVER_DC and TG_SERVER_IP)"
      },
      "TG_PROXY_HOST": {
        "type": "string",
        "required": false,
        "description": "Telegram proxy host (TG_* alias)"
      },
      "TG_PROXY_PORT": {
        "type": "number",
        "required": false,
        "description": "Telegram proxy port (TG_* alias)"
      },
      "TG_PROXY_TYPE": {
        "type": "string",
        "required": false,
        "enum": [
          "socks4",
          "socks5"
        ],
        "description": "Telegram proxy type (TG_* alias)"
      },
      "TG_PROXY_USERNAME": {
        "type": "string",
        "required": false,
        "description": "Telegram proxy username (TG_* alias)"
      },
      "TG_PROXY_PASSWORD": {
        "type": "string",
        "required": false,
        "description": "Telegram proxy password (TG_* alias)"
      },
      "CACHE_PROVIDERS": {
        "type": "string",
        "required": false,
        "description": "JSON 格式的缓存提供者配置数组，支持优先级和多实例配置。例如: [{\"type\":\"valkey\",\"priority\":1,\"host\":\"...\",\"port\":6379,\"name\":\"primary\"}]"
      },
      "PRIMARY_CACHE_PROVIDER": {
        "type": "string",
        "required": false,
        "description": "强制指定某个配置的 name 作为主缓存提供者，用于覆盖优先级或故障转移后的选择"
      },
      "INFISICAL_CLIENT_ID": {
        "type": "string",
        "required": false,
        "description": "Infisical client ID"
      },
      "INFISICAL_CLIENT_SECRET": {
        "type": "string",
        "required": false,
        "description": "Infisical client secret",
        "sensitive": true,
        "configPaths": [
          "clientSecret"
        ]
      },
      "INFISICAL_TOKEN": {
        "type": "string",
        "required": false,
        "description": "Infisical access token",
        "sensitive": true,
        "configPaths": [
          "token"
        ]
      },
      "INFISICAL_PROJECT_ID": {
        "type": "string",
        "required": false,
        "description": "Infisical project ID"
      },
      "INFISICAL_ENV": {
        "type": "string",
        "required": false,
        "description": "Infisical environment name"
      },
      "INFISICAL_SECRET_PATH": {
        "type": "string",
        "required": false,
        "description": "Infisical secret path"
      },
      "STRICT_SYNC": {
        "type": "boolean",
        "required": false,
        "description": "Infisical sync strict mode"
      },
      "SKIP_INFISICAL_RUNTIME": {
        "type": "boolean",
        "required": false,
        "description": "Skip Infisical runtime fetch"
      },
      "INFISICAL_POLLING_ENABLED": {
        "type": "boolean",
        "required": false,
        "default": false,
        "description": "Enable Infisical secrets polling (auto-update on remote changes)"
      },
      "INFISICAL_POLLING_INTERVAL": {
        "type": "number",
        "required": false,
        "default": 300000,
        "description": "Infisical polling interval in milliseconds (default: 300000ms = 5 minutes)"
      },
      "TUNNEL_ENABLED": {
        "type": "string",
        "required": false,
        "description": "Cloudflare Tunnel 启用状态"
      },
      "TUNNEL_PROVIDER": {
        "type": "string",
        "required": false,
        "description": "Cloudflare Tunnel 提供商"
      },
      "TUNNEL_METRICS_PORT": {
        "type": "number",
        "required": false,
        "description": "Cloudflare Tunnel 指标端口"
      },
      "TUNNEL_METRICS_HOST": {
        "type": "string",
        "required": false,
        "description": "Cloudflare Tunnel 指标地址"
      },
      "STREAM_FORWARDING_ENABLED": {
        "type": "boolean",
        "default": false,
        "description": "是否开启流式转发上传模式"
      },
      "INSTANCE_SECRET": {
        "type": "string",
        "required": false,
        "description": "实例间通信安全秘钥"
      },
      "NEW_RELIC_LICENSE_KEY": {
        "type": "string",
        "required": false,
        "description": "New Relic 许可证密钥",
        "sensitive": true
      },
      "NEW_RELIC_REGION": {
        "type": "string",
        "required": false,
        "enum": [
          "US",
          "EU"
        ],
        "default": "US",
        "description": "New Relic 区域 (US 或 EU)"
      },
      "NEW_RELIC_APP_NAME": {
        "type": "string",
        "required": false,
        "description": "New Relic 应用名称"
      }
    }
  },
  "endpoints": {
    "health": "/health",
    "healthz": "/healthz",
    "ready": "/ready",
    "webhookBase": "/api/v2/tasks",
    "download": "/api/v2/tasks/download",
    "upload": "/api/v2/tasks/upload",
    "batch": "/api/v2/tasks/batch",
    "systemEvents": "/api/v2/tasks/system-events",
    "streamForward": "/api/v2/stream/:taskId",
    "statusUpdate": "/api/v2/tasks/:taskId/status",
    "configRefresh": "/api/v2/config/refresh",
    "legacyWebhookBase": "/api/tasks",
    "legacyDownload": "/api/tasks/download",
    "legacyUpload": "/api/tasks/upload",
    "legacyBatch": "/api/tasks/batch",
    "legacySystemEvents": "/api/tasks/system-events"
  }
}
